FROM node:20-slim

ARG WORKOS_CLIENT_ID
ARG WORKOS_API_KEY
ARG WORKOS_COOKIE_PASSWORD
ARG WORKOS_CONNECTION_ID
ARG WORKOS_ORGANIZATION_ID
ARG NEXT_PUBLIC_WORKOS_REDIRECT_URI

ENV WORKOS_CLIENT_ID=${WORKOS_CLIENT_ID} \
    WORKOS_API_KEY=${WORKOS_API_KEY} \
    WORKOS_COOKIE_PASSWORD=${WORKOS_COOKIE_PASSWORD} \
    WORKOS_CONNECTION_ID=${WORKOS_CONNECTION_ID} \
    WORKOS_ORGANIZATION_ID=${WORKOS_ORGANIZATION_ID} \
    NEXT_PUBLIC_WORKOS_REDIRECT_URI=${NEXT_PUBLIC_WORKOS_REDIRECT_URI}
    
WORKDIR /app

COPY client-a .

RUN rm -rf package-lock.json node_modules && npm install

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
